!function(t,n){"use strict";null==t&&(t="undefined"!=typeof window&&"undefined"!=typeof document?window:global),t.ruta=n(t)}(this,function(t){"use strict";function n(){return null==d&&(d=new m(w)),d}var r,e,i,u,o=t.mask||Mask,a=!0;!function(){function t(t){for(var n,r,e=t.trim().split(/\s+/),i=e.length,u=-1;++u<i;)if(r=e[u],0!==r.length&&(n=r[0],'"'===n||"'"===n))for(var o=u;i>u;u++)if(r=e[u],r[r.length-1]===n){var a=e.splice(o,u-o+1).join(" ").slice(1,-1);e.splice(o,0,a),i=e.length;break}return e}function n(t){for(var n,r,e,i=t.length,u=0,o={},a=[];i>u;u++)e=t[u],"-"!==e[0]?a.push(e):(n=e.replace(/^[\-]+/,""),i-1>u&&"-"!==t[u+1][0]?(r=t[u+1],u++):r=!0,o[n]=r);return{path:a,query:o}}r=function(t){for(var n=t.length,r=0,e=n-1;n>r&&"/"===t[r];r++);for(;e>r&&"/"===t[e];e--);return t.substring(r,e+1)},e=function(t){return t=r(t),""===t?[]:t.split("/")},i=function(t){return"/"+t.join("/")},u=function(r){"string"==typeof r&&(r=t(r));var e=n(r);return p(e)}}();var s,l;!function(){function t(t,n,r){for(var e,i=n.split("."),u=i.length,o=-1;++o<u-1;)e=i[o],null==t[e]&&(t[e]={}),t=t[e];t[i[o]]=r}function n(t){try{return decodeURIComponent(t)}catch(n){return""}}s=function(r,e){null==e&&(e="/");for(var i,u,o={},a=r.split(e),s=0,l=a.length;l>s;s++)i=a[s].split("="),u=null==i[1]?"":n(i[1]),t(o,i[0],u);return o},l=function(t,n){null==n&&(n="/");var r,e="";for(r in t)e=e+(e?n:"")+r+"="+encodeURIComponent(t[r]);return e}}();var c,f,h;!function(){c=function(t,n){return new RegExp(t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),n)},f=function(t){if("^"===t[0])return new RegExp(t);for(var n=t.split("|"),r=0,e=n.length;e>r;r++)n[r]="^"+n[r]+"$";return new RegExp(n.join("|"))},h=function(t){var n=t.indexOf("("),r=t.lastIndexOf(")");if(-1===n||-1===r)return console.error("<ruta> Expected alias part with regexp",t),null;var e=t.substring(n+1,r);return{alias:t.substring(1,n),matcher:f(e)}}}();var p,g;!function(){p=function(t){var n=i(t.path);return null==t.query?n:n+"?"+l(t.query,"&")},g=function(t){var n=t.indexOf("?"),r=-1===n?t:t.substring(0,n);return{path:e(r),query:-1===n?null:s(t.substring(n+1),"&")}}}();var d,v=function(){function t(t,n){this.method=36===t.charCodeAt(0)?t.substring(1,t.indexOf(" ")).toUpperCase():null,null!=this.method&&(t=t.substring(this.method.length+2)),this.strict=a,this.value=n,this.definition=t,r(this,t)}function n(){this.routes=[]}var r,i;!function(){function t(t,n){for(var r in t)if(n.test(r))return t[r]}r=function(t,n){var r=n.charCodeAt(0);switch(r){case 33:t.strict=!0,n=n.substring(1);break;case 94:t.strict=!1,n=n.substring(1);break;case 40:var e=1,i=n.length-1;return 41!==n.charCodeAt(n.length-1)&&(console.error("<ruta> rgx parse - expect group closing"),i++),void(t.match=new RegExp(n.substring(e,i)))}var u,o,a,s,l,c,h=n.split("/"),p=0,g=h.length,d=h[g-1];o=d.indexOf("?"),o>(1===g?-1:0)&&(u=d.substring(o+1),h[g-1]=d.substring(0,o));for(var v,m,w,y=!0,b=t.path=[];g>p;p++)if(a=h[p],""!==a){s=a.charCodeAt(0),c=a.charCodeAt(1),v=63===s,m=58===(v?c:s),l=0,v&&l++,m&&l++,0!==l&&(a=a.substring(l)),!v&&!y&&console.log("<ruta> strict part found after optional",n),v&&(y=!1);var x=a.indexOf("(");if(m&&-1!==x){var i=a.length-1;")"!==a[i]&&(i+=1),w=new RegExp(f(a.substring(x+1,i))),a=a.substring(0,x)}v||m?m&&b.push({alias:a,matcher:w,optional:v}):b.push(a)}if(u){var q=t.query={};h=u.split("&"),p=-1,g=h.length;for(var C,R,A,O;++p<g;)A=h[p],O=A.indexOf("="),-1!==O?(C=A.substring(0,O),R=A.substring(O+1),40===R.charCodeAt(0)&&(R=new RegExp(f(R))),q[C]=R):q[A]="";0===t.path.length&&(t.strict=!1)}},i=function(n,r){var i=r.indexOf("?"),u=-1===i?null:r.substring(i+1),o={path:r,params:null==u?{}:s(u,"&")};if(n.query)for(var a in n.query)if("?"===a[0]&&(a=a.substring(1)),":"===a[0]){var l=h(a),c=l.alias;o.params[c]=t(o.params,l.matcher)}if(-1!==i&&(r=r.substring(0,i)),null!=n.path)for(var f,p,g=e(r),d=n.path,v=d.length,m=g.length,w=0;m>w;w++)if(f=g[w],p=v>w?d[w]:null){if("string"==typeof p)continue;if(p.alias){o.params[p.alias]=f;continue}}return o}}();var u,o;return!function(){function t(t,n){for(var r in t)if(n.test(r))return!0;return!1}u=function(t,n,r){for(var e,u=g(t),a=0,s=n.length;s>a;a++)if(e=n[a],o(u,e,r))return e.current=i(e,t),e;return null},o=function(n,r,e){if(null!=e&&null!=r.method&&r.method!==e)return!1;if(r.match)return r.match.test("string"==typeof n?n:p(n));if("string"==typeof n&&(n=g(n)),r.query){var i,u,o=n.query;if(null==o)return!1;for(i in r.query){u=r.query[i];var a=i[0];if(":"!==a){if("?"!==a)if("string"!=typeof u){if(u.test&&!u.test(o[i]))return!1}else{if(null==o[i])return!1;if(u&&o[i]!==u)return!1}}else{var s=h(i);if(null==s||t(o,s.matcher)===!1)return!1}}}var l=r.path,c=l.length;if(0===c)return r.strict?0===n.path.length:!0;for(var f,d=0,v=n.path.length;v>d;d++){if(f=l[d],d>=c)return r.strict!==!0;if("string"==typeof f){if(n.path[d]===f)continue;return!1}if(f.matcher&&f.matcher.test(n.path[d])===!1)return!1;if(f.optional)return!0;if(!f.alias)return!1}return c>d?l[d].optional===!0:!0}}(),t.prototype={path:null,query:null,value:null,current:null},n.prototype={add:function(n,r){return this.routes.push(new t(n,r)),this},get:function(t,n){return u(t,this.routes,n)},clear:function(){return this.routes.length=0,this}},n.parse=function(t,n){var e={};return r(e,t),i(e,n)},n}(),m=function(){function t(t){if("undefined"==typeof window||"onhashchange"in window==0)return null;var n=this;return n.listener=t,window.onhashchange=function(){n.changed(location.hash)},n}function n(t){if("undefined"==typeof window)return null;if(!window.history||!window.history.pushState)return null;var n=this;return n.listener=t,n.initial=location.pathname,window.onpopstate=function(){return n.initial===location.pathname?void(n.initial=null):void n.changed()},n}function r(r,e){if(this.collection=r||new v,e){var i="hash"===e?t:n;this.emitter=new i(this)}null==this.emitter&&(this.emitter=new n(this)),null==this.emitter&&(this.emitter=new t(this)),null==this.emitter&&console.error("Router can not be initialized - (nor History API / nor Hashchage")}return"undefined"==typeof window?function(){}:(function(){function n(t){return t.replace(/^[!#/]+/,"/")}t.prototype={navigate:function(t){return null==t?void this.changed(location.hash):void(location.hash=t)},changed:function(t){this.listener.changed(n(t))},current:function(){return n(location.hash)}}}(),function(){n.prototype={navigate:function(t){return null==t?void this.changed():(history.pushState({},null,t),void this.changed())},changed:function(){this.listener.changed(location.pathname+location.search)},current:function(){return location.pathname+location.search}}}(),r.prototype={changed:function(t){var n=this.collection.get(t);n&&this.action(n)},action:function(t){"function"==typeof t.value&&t.value(t)},navigate:function(t){this.emitter.navigate(t)},current:function(){var t=this.emitter.current();return this.collection.get(t)}},r)}(),w=new v,y={Collection:v,setRouterType:function(t){return null==d&&(d=new m(w,t)),this},setStrictBehaviour:function(t){a=t},add:function(t,r){return n(),w.add(t,r)},get:function(t){return w.get(t)},navigate:function(t){n().navigate(t)},current:function(){return n().current()},parse:v.parse,$utils:{pathFromCLI:u}};return function(){function t(t){t.preventDefault(),t.stopPropagation(),y.navigate(this.href)}o.registerAttrHandler("x-dynamic",function(n,r,e,i,u){u.onclick=t},"client")}(),y});