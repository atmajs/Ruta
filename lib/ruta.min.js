(function(t,n){"use strict";null==t&&(t="undefined"!=typeof window&&"undefined"!=typeof document?window:global),t.ruta=n(t)})(this,function(t){"use strict";function n(t){for(var n=t.length,e=0,i=n-1;n>e&&"/"===t[e];e++);for(;i>e&&"/"===t[i];i--);return t.substring(e,i+1)}function e(t){return t=n(t),""===t?[]:t.split("/")}function i(t,n){null==n&&(n="/");for(var e,i={},r=t.split(n),o=0,u=r.length;u>o;o++)e=r[o].split("="),i[e[0]]=decodeURIComponent(e[1]);return i}function r(t){if("^"===t[0])return RegExp(t);for(var n=t.split("|"),e=0,i=n.length;i>e;e++)n[e]="^"+n[e]+"$";return RegExp(n.join("|"))}function o(){return null==u&&(u=new c(l)),u}var u,a=t.mask||Mask,s=function(){function t(t,n){if(33===n.charCodeAt(0)&&(t.strict=!0,n=n.substring(1)),40===n.charCodeAt(0)){var e=1,i=n.length-1;return 41!==n.charCodeAt(n.length-1)&&(console.error("<ruta> rgx parse - expect group closing"),i++),t.match=RegExp(n.substring(e,i)),void 0}for(var o,u,a,s,c,l,h,f=n.split("/"),p=0,g=f.length,d=!0,v=t.parts=[];g>p;p++)if(o=f[p],""!==o){u=o.charCodeAt(0),s=o.charCodeAt(1),c=63===u,l=58===(c?s:u),a=0,c&&a++,l&&a++,0!==a&&(o=o.substring(a)),!c&&!d&&console.log("<ruta> strict part found after optional",n),c&&(d=!1);var w=o.indexOf("(");if(l&&-1!==w){var i=o.length-1;")"!==o[i]&&(i+=1),h=RegExp(r(o.substring(w+1,i))),o=o.substring(0,w)}c||l?l&&v.push({alias:o,matcher:h,optional:c}):v.push(o)}}function o(t,n){var r=n.indexOf("?"),o=-1===r?null:n.substring(r+1),u={path:n,params:null==o?{}:i(o,"&")};-1!==r&&(n=n.substring(0,r));for(var a,s,c=e(n),l=t.parts,h=l.length,f=c.length,p=0;f>p;p++)if(a=c[p],s=h>p?l[p]:null){if("string"==typeof s)continue;if(s.alias){u.params[s.alias]=a;continue}}return u}function u(t,i){t=n(t);for(var r,u=t.indexOf("?"),s=-1===u?t:t.substring(0,u),c=e(s),l=0,h=i.length;h>l;l++)if(r=i[l],a(c,r))return r.current=o(r,t),r;return null}function a(t,n){if(n.match)return n.match.test("string"==typeof t?t:t.join("/"));"string"==typeof t&&(t=e(t));for(var i,r=n.parts,o=r.length,u=0,a=t.length;a>u;u++){if(i=r[u],u>=o)return n.strict!==!0;if("string"==typeof i){if(t[u]===i)continue;return!1}if(i.matcher&&i.matcher.test(t[u])===!1)return!1;if(i.optional)return!0;if(!i.alias)return!1}return o>u?r[u].optional===!0:!0}function s(n,e){this.method=36===n.charCodeAt(0)?n.substring(1,n.indexOf(" ")).toUpperCase():"",""!==this.method&&(n=n.substring(this.method.length+2)),this.value=e,this.definition=n,t(this,n)}function c(){this.routes=[]}return s.prototype={parts:null,value:null,current:null},c.prototype={add:function(t,n){return this.routes.push(new s(t,n)),this},get:function(t){return u(t,this.routes)}},c.parse=function(n,e){var i={};return t(i,n),o(i,e)},c}(),c=function(){function t(t){if("undefined"==typeof window||"onhashchange"in window==!1)return null;var n=this;return n.listener=t,window.onhashchange=function(){n.changed(location.hash)},n}function n(t){if("undefined"==typeof window)return null;if(!window.history||!window.history.pushState)return null;var n=this;return n.listener=t,n.initial=location.pathname,window.onpopstate=function(){return n.initial===location.pathname?(n.initial=null,void 0):(n.changed(),void 0)},n}function e(e,i){if(this.collection=e||new s,i){var r="hash"===i?t:n;this.emitter=new r(this)}null==this.emitter&&(this.emitter=new n(this)),null==this.emitter&&(this.emitter=new t(this)),null==this.emitter&&console.error("Router can not be initialized - (nor History API / nor Hashchage")}return"undefined"==typeof window?function(){}:(function(){function n(t){return t.replace(/^[!#/]+/,"/")}t.prototype={navigate:function(t){location.hash=t},changed:function(t){this.listener.changed(n(t))},current:function(){return n(location.hash)}}}(),function(){n.prototype={navigate:function(t){history.pushState({},null,t),this.changed()},changed:function(){this.listener.changed(location.pathname+location.search)},current:function(){return location.pathname+location.search}}}(),e.prototype={changed:function(t){var n=this.collection.get(t);n&&this.action(n)},action:function(t){"function"==typeof t.value&&t.value(t)},navigate:function(t){this.emitter.navigate(t)},current:function(){var t=this.emitter.current();return this.collection.get(t)}},e)}(),l=new s,h={Collection:s,setRouterType:function(t){return null==u&&(u=new c(l,t)),this},add:function(t,n){return o(),l.add(t,n)},get:function(t){return l.get(t)},navigate:function(t){o().navigate(t)},current:function(){return o().current()},parse:s.parse};return function(){function t(t){t.preventDefault(),t.stopPropagation(),h.navigate(this.href)}a.registerAttrHandler("x-dynamic",function(n,e,i,r,o){o.onclick=t},"client")}(),h});