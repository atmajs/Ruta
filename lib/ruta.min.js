(function(t,n){"use strict";null==t&&(t="undefined"!=typeof window&&"undefined"!=typeof document?window:global),t.ruta=n(t)})(this,function(t){"use strict";function n(t){for(var n=t.length,e=0,i=n-1;n>e&&"/"===t[e];e++);for(;i>e&&"/"===t[i];i--);return t.substring(e,i+1)}function e(t){return t=n(t),""===t?[]:t.split("/")}function i(t){var n=t.indexOf("?"),i=-1===n?t:t.substring(0,n);return e(i)}function r(t,n){null==n&&(n="/");for(var e,i={},r=t.split(n),o=0,u=r.length;u>o;o++)e=r[o].split("="),i[e[0]]=decodeURIComponent(e[1]);return i}function o(t){if("^"===t[0])return RegExp(t);for(var n=t.split("|"),e=0,i=n.length;i>e;e++)n[e]="^"+n[e]+"$";return RegExp(n.join("|"))}function u(){return null==a&&(a=new h(f)),a}var a,s=t.mask||Mask,c=!0,l=function(){function t(t,n){var e=n.charCodeAt(0);switch(e){case 33:t.strict=!0,n=n.substring(1);break;case 94:t.strict=!1,n=n.substring(1);break;case 40:var i=1,r=n.length-1;return 41!==n.charCodeAt(n.length-1)&&(console.error("<ruta> rgx parse - expect group closing"),r++),t.match=RegExp(n.substring(i,r)),void 0}for(var u,a,s,c,l,h,f,p=n.split("/"),g=0,d=p.length,v=!0,m=t.parts=[];d>g;g++)if(u=p[g],""!==u){a=u.charCodeAt(0),c=u.charCodeAt(1),l=63===a,h=58===(l?c:a),s=0,l&&s++,h&&s++,0!==s&&(u=u.substring(s)),!l&&!v&&console.log("<ruta> strict part found after optional",n),l&&(v=!1);var w=u.indexOf("(");if(h&&-1!==w){var r=u.length-1;")"!==u[r]&&(r+=1),f=RegExp(o(u.substring(w+1,r))),u=u.substring(0,w)}l||h?h&&m.push({alias:u,matcher:f,optional:l}):m.push(u)}}function n(t,n){var i=n.indexOf("?"),o=-1===i?null:n.substring(i+1),u={path:n,params:null==o?{}:r(o,"&")};-1!==i&&(n=n.substring(0,i));for(var a,s,c=e(n),l=t.parts,h=l.length,f=c.length,p=0;f>p;p++)if(a=c[p],s=h>p?l[p]:null){if("string"==typeof s)continue;if(s.alias){u.params[s.alias]=a;continue}}return u}function u(t,e,r){for(var o,u=i(t),s=0,c=e.length;c>s;s++)if(o=e[s],a(u,o,r))return o.current=n(o,t),o;return null}function a(t,n,e){if(null!=e&&null!=n.method&&n.method!==e)return!1;if(n.match)return n.match.test("string"==typeof t?t:t.join("/"));"string"==typeof t&&(t=i(t));for(var r,o=n.parts,u=o.length,a=0,s=t.length;s>a;a++){if(r=o[a],a>=u)return n.strict!==!0;if("string"==typeof r){if(t[a]===r)continue;return!1}if(r.matcher&&r.matcher.test(t[a])===!1)return!1;if(r.optional)return!0;if(!r.alias)return!1}return u>a?o[a].optional===!0:!0}function s(n,e){this.method=36===n.charCodeAt(0)?n.substring(1,n.indexOf(" ")).toUpperCase():null,null!=this.method&&(n=n.substring(this.method.length+2)),this.strict=c,this.value=e,this.definition=n,t(this,n)}function l(){this.routes=[]}return s.prototype={parts:null,value:null,current:null},l.prototype={add:function(t,n){return this.routes.push(new s(t,n)),this},get:function(t,n){return u(t,this.routes,n)}},l.parse=function(e,i){var r={};return t(r,e),n(r,i)},l}(),h=function(){function t(t){if("undefined"==typeof window||"onhashchange"in window==!1)return null;var n=this;return n.listener=t,window.onhashchange=function(){n.changed(location.hash)},n}function n(t){if("undefined"==typeof window)return null;if(!window.history||!window.history.pushState)return null;var n=this;return n.listener=t,n.initial=location.pathname,window.onpopstate=function(){return n.initial===location.pathname?(n.initial=null,void 0):(n.changed(),void 0)},n}function e(e,i){if(this.collection=e||new l,i){var r="hash"===i?t:n;this.emitter=new r(this)}null==this.emitter&&(this.emitter=new n(this)),null==this.emitter&&(this.emitter=new t(this)),null==this.emitter&&console.error("Router can not be initialized - (nor History API / nor Hashchage")}return"undefined"==typeof window?function(){}:(function(){function n(t){return t.replace(/^[!#/]+/,"/")}t.prototype={navigate:function(t){location.hash=t},changed:function(t){this.listener.changed(n(t))},current:function(){return n(location.hash)}}}(),function(){n.prototype={navigate:function(t){history.pushState({},null,t),this.changed()},changed:function(){this.listener.changed(location.pathname+location.search)},current:function(){return location.pathname+location.search}}}(),e.prototype={changed:function(t){var n=this.collection.get(t);n&&this.action(n)},action:function(t){"function"==typeof t.value&&t.value(t)},navigate:function(t){this.emitter.navigate(t)},current:function(){var t=this.emitter.current();return this.collection.get(t)}},e)}(),f=new l,p={Collection:l,setRouterType:function(t){return null==a&&(a=new h(f,t)),this},setStrictBehaviour:function(t){c=t},add:function(t,n){return u(),f.add(t,n)},get:function(t){return f.get(t)},navigate:function(t){u().navigate(t)},current:function(){return u().current()},parse:l.parse};return function(){function t(t){t.preventDefault(),t.stopPropagation(),p.navigate(this.href)}s.registerAttrHandler("x-dynamic",function(n,e,i,r,o){o.onclick=t},"client")}(),p});