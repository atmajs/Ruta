(function(t,n){"use strict";null==t&&(t="undefined"!=typeof window&&"undefined"!=typeof document?window:global),t.ruta=n(t)})(this,function(t){"use strict";function n(t){if("^"===t[0])return RegExp(t);for(var n=t.split("|"),r=0,e=n.length;e>r;r++)n[r]="^"+n[r]+"$";return RegExp(n.join("|"))}function r(){return null==p&&(p=new d(v)),p}var e,i,u,o,a=t.mask||Mask,s=!0;(function(){function t(t){for(var n,r,e=t.trim().split(/\s+/),i=e.length,u=-1;i>++u;)if(r=e[u],0!==r.length&&(n=r[0],'"'===n||"'"===n))for(var o=u;i>u;u++)if(r=e[u],r[r.length-1]===n){var a=e.splice(o,u-o+1).join(" ").slice(1,-1);e.splice(o,0,a),i=e.length;break}return e}function n(t){for(var n,r,e,i=t.length,u=0,o={},a=[];i>u;u++)e=t[u],"-"!==e[0]?a.push(e):(n=e.replace(/^[\-]+/,""),i-1>u&&"-"!==t[u+1][0]?(r=t[u+1],u++):r=!0,o[n]=r);return{path:a,query:o}}e=function(t){for(var n=t.length,r=0,e=n-1;n>r&&"/"===t[r];r++);for(;e>r&&"/"===t[e];e--);return t.substring(r,e+1)},i=function(t){return t=e(t),""===t?[]:t.split("/")},u=function(t){return"/"+t.join("/")},o=function(r){"string"==typeof r&&(r=t(r));var e=n(r);return f(e)}})();var l,c;(function(){l=function(t,n){null==n&&(n="/");for(var r,e={},i=t.split(n),u=0,o=i.length;o>u;u++)r=i[u].split("="),e[r[0]]=null==r[1]?"":decodeURIComponent(r[1]);return e},c=function(t,n){null==n&&(n="/");var r,e="";for(r in t)e=(e?n:"")+r+"="+encodeURIComponent(t[r]);return e}})();var f,h;(function(){f=function(t){var n=u(t.path);return null==t.query?n:n+"?"+c(t.query,"&")},h=function(t){var n=t.indexOf("?"),r=-1===n?t:t.substring(0,n);return{path:i(r),query:-1===n?null:l(t.substring(n+1),"&")}}})();var p,g=function(){function t(t,r){var e=r.charCodeAt(0);switch(e){case 33:t.strict=!0,r=r.substring(1);break;case 94:t.strict=!1,r=r.substring(1);break;case 40:var i=1,u=r.length-1;return 41!==r.charCodeAt(r.length-1)&&(console.error("<ruta> rgx parse - expect group closing"),u++),t.match=RegExp(r.substring(i,u)),void 0}var o,a,s,l,c,f,h=r.split("/"),p=0,g=h.length,d=h[g-1];a=d.indexOf("?"),a>(1===g?-1:0)&&(o=d.substring(a+1),h[g-1]=d.substring(0,a));for(var v,y,m,w=!0,b=t.path=[];g>p;p++)if(s=h[p],""!==s){l=s.charCodeAt(0),f=s.charCodeAt(1),v=63===l,y=58===(v?f:l),c=0,v&&c++,y&&c++,0!==c&&(s=s.substring(c)),!v&&!w&&console.log("<ruta> strict part found after optional",r),v&&(w=!1);var x=s.indexOf("(");if(y&&-1!==x){var u=s.length-1;")"!==s[u]&&(u+=1),m=RegExp(n(s.substring(x+1,u))),s=s.substring(0,x)}v||y?y&&b.push({alias:s,matcher:m,optional:v}):b.push(s)}if(o){var C=t.query={};h=o.split("&"),p=-1,g=h.length;for(var q,R,A,k;g>++p;)A=h[p],k=A.indexOf("="),-1!==k?(q=A.substring(0,k),R=A.substring(k+1),40===R.charCodeAt(0)&&(R=RegExp(n(R))),C[q]=R):C[A]="";0===t.path.length&&(t.strict=!1)}}function r(t,n){var r=n.indexOf("?"),e=-1===r?null:n.substring(r+1),u={path:n,params:null==e?{}:l(e,"&")};if(-1!==r&&(n=n.substring(0,r)),null!=t.path)for(var o,a,s=i(n),c=t.path,f=c.length,h=s.length,p=0;h>p;p++)if(o=s[p],a=f>p?c[p]:null){if("string"==typeof a)continue;if(a.alias){u.params[a.alias]=o;continue}}return u}function e(t,n,e){for(var i,o=h(t),a=0,s=n.length;s>a;a++)if(i=n[a],u(o,i,e))return i.current=r(i,t),i;return null}function u(t,n,r){if(null!=r&&null!=n.method&&n.method!==r)return!1;if(n.match)return n.match.test("string"==typeof t?t:f(t));if("string"==typeof t&&(t=h(t)),n.query){var e,i,u=t.query;if(null==u)return!1;for(e in n.query)if(i=n.query[e],"string"!=typeof i){if(i.test&&!i.test(u[e]))return!1}else{if(null==u[e])return!1;if(i&&u[e]!==i)return!1}}var o=n.path,a=o.length;if(0===a)return n.strict?0===t.path.length:!0;for(var s,l=0,c=t.path.length;c>l;l++){if(s=o[l],l>=a)return n.strict!==!0;if("string"==typeof s){if(t.path[l]===s)continue;return!1}if(s.matcher&&s.matcher.test(t.path[l])===!1)return!1;if(s.optional)return!0;if(!s.alias)return!1}return a>l?o[l].optional===!0:!0}function o(n,r){this.method=36===n.charCodeAt(0)?n.substring(1,n.indexOf(" ")).toUpperCase():null,null!=this.method&&(n=n.substring(this.method.length+2)),this.strict=s,this.value=r,this.definition=n,t(this,n)}function a(){this.routes=[]}return o.prototype={path:null,query:null,value:null,current:null},a.prototype={add:function(t,n){return this.routes.push(new o(t,n)),this},get:function(t,n){return e(t,this.routes,n)}},a.parse=function(n,e){var i={};return t(i,n),r(i,e)},a}(),d=function(){function t(t){if("undefined"==typeof window||"onhashchange"in window==!1)return null;var n=this;return n.listener=t,window.onhashchange=function(){n.changed(location.hash)},n}function n(t){if("undefined"==typeof window)return null;if(!window.history||!window.history.pushState)return null;var n=this;return n.listener=t,n.initial=location.pathname,window.onpopstate=function(){return n.initial===location.pathname?(n.initial=null,void 0):(n.changed(),void 0)},n}function r(r,e){if(this.collection=r||new g,e){var i="hash"===e?t:n;this.emitter=new i(this)}null==this.emitter&&(this.emitter=new n(this)),null==this.emitter&&(this.emitter=new t(this)),null==this.emitter&&console.error("Router can not be initialized - (nor History API / nor Hashchage")}return"undefined"==typeof window?function(){}:(function(){function n(t){return t.replace(/^[!#/]+/,"/")}t.prototype={navigate:function(t){location.hash=t},changed:function(t){this.listener.changed(n(t))},current:function(){return n(location.hash)}}}(),function(){n.prototype={navigate:function(t){history.pushState({},null,t),this.changed()},changed:function(){this.listener.changed(location.pathname+location.search)},current:function(){return location.pathname+location.search}}}(),r.prototype={changed:function(t){var n=this.collection.get(t);n&&this.action(n)},action:function(t){"function"==typeof t.value&&t.value(t)},navigate:function(t){this.emitter.navigate(t)},current:function(){var t=this.emitter.current();return this.collection.get(t)}},r)}(),v=new g,y={Collection:g,setRouterType:function(t){return null==p&&(p=new d(v,t)),this},setStrictBehaviour:function(t){s=t},add:function(t,n){return r(),v.add(t,n)},get:function(t){return v.get(t)},navigate:function(t){r().navigate(t)},current:function(){return r().current()},parse:g.parse,$utils:{pathFromCLI:o}};return function(){function t(t){t.preventDefault(),t.stopPropagation(),y.navigate(this.href)}a.registerAttrHandler("x-dynamic",function(n,r,e,i,u){u.onclick=t},"client")}(),y});