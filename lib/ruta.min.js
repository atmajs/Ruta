(function(t,n){"use strict";null==t&&(t="undefined"!=typeof window&&"undefined"!=typeof document?window:global),t.ruta=n(t)})(this,function(t){"use strict";function n(t){for(var n=t.length,e=0,r=n-1;n>e&&"/"===t[e];e++);for(;r>e&&"/"===t[r];r--);return t.substring(e,r+1)}function e(t){return t=n(t),""===t?[]:t.split("/")}function r(t){return"/"+t.join("/")}function i(t,n){null==n&&(n="/");for(var e,r={},i=t.split(n),u=0,o=i.length;o>u;u++)e=i[u].split("="),r[e[0]]=null==e[1]?"":decodeURIComponent(e[1]);return r}function u(t,n){null==n&&(n="/");var e,r="";for(e in t)r=(r?n:"")+e+"="+encodeURIComponent(t[e]);return r}function o(t){if("^"===t[0])return RegExp(t);for(var n=t.split("|"),e=0,r=n.length;r>e;e++)n[e]="^"+n[e]+"$";return RegExp(n.join("|"))}function a(t){var n=r(t.path);return null==t.query?n:n+"?"+u(t.query,"&")}function s(t){var n=t.indexOf("?"),r=-1===n?t:t.substring(0,n);return{path:e(r),query:-1===n?null:i(t.substring(n+1),"&")}}function c(){return null==l&&(l=new g(d)),l}var l,h=t.mask||Mask,f=!0,p=function(){function t(t,n){var e=n.charCodeAt(0);switch(e){case 33:t.strict=!0,n=n.substring(1);break;case 94:t.strict=!1,n=n.substring(1);break;case 40:var r=1,i=n.length-1;return 41!==n.charCodeAt(n.length-1)&&(console.error("<ruta> rgx parse - expect group closing"),i++),t.match=RegExp(n.substring(r,i)),void 0}var u,a,s,c,l,h,f=n.split("/"),p=0,g=f.length,d=f[g-1];a=d.indexOf("?"),a>(1===g?-1:0)&&(u=d.substring(a+1),f[g-1]=d.substring(0,a));for(var v,m,y,w=!0,b=t.path=[];g>p;p++)if(s=f[p],""!==s){c=s.charCodeAt(0),h=s.charCodeAt(1),v=63===c,m=58===(v?h:c),l=0,v&&l++,m&&l++,0!==l&&(s=s.substring(l)),!v&&!w&&console.log("<ruta> strict part found after optional",n),v&&(w=!1);var x=s.indexOf("(");if(m&&-1!==x){var i=s.length-1;")"!==s[i]&&(i+=1),y=RegExp(o(s.substring(x+1,i))),s=s.substring(0,x)}v||m?m&&b.push({alias:s,matcher:y,optional:v}):b.push(s)}if(u){var C=t.query={};f=u.split("&"),p=-1,g=f.length;for(var q,R,A,O;g>++p;)A=f[p],O=A.indexOf("="),-1!==O?(q=A.substring(0,O),R=A.substring(O+1),40===R.charCodeAt(0)&&(R=RegExp(o(R))),C[q]=R):C[A]="";0===t.path.length&&(t.strict=!1)}}function n(t,n){var r=n.indexOf("?"),u=-1===r?null:n.substring(r+1),o={path:n,params:null==u?{}:i(u,"&")};-1!==r&&(n=n.substring(0,r));for(var a,s,c=e(n),l=t.path,h=l.length,f=c.length,p=0;f>p;p++)if(a=c[p],s=h>p?l[p]:null){if("string"==typeof s)continue;if(s.alias){o.params[s.alias]=a;continue}}return o}function r(t,e,r){for(var i,o=s(t),a=0,c=e.length;c>a;a++)if(i=e[a],u(o,i,r))return null==i.parts?(i.current={params:{}},i):(i.current=n(i,t),i);return null}function u(t,n,e){if(null!=e&&null!=n.method&&n.method!==e)return!1;if(n.match)return n.match.test("string"==typeof t?t:a(t));if("string"==typeof t&&(t=s(t)),n.query){var r,i,u=t.query;if(null==u)return!1;for(r in n.query)if(i=n.query[r],"string"!=typeof i){if(i.test&&!i.test(u[r]))return!1}else{if(null==u[r])return!1;if(i&&u[r]!==i)return!1}}var o=n.path,c=o.length;if(0===c)return n.strict?0===t.path.length:!0;for(var l,h=0,f=t.path.length;f>h;h++){if(l=o[h],h>=c)return n.strict!==!0;if("string"==typeof l){if(t.path[h]===l)continue;return!1}if(l.matcher&&l.matcher.test(t.path[h])===!1)return!1;if(l.optional)return!0;if(!l.alias)return!1}return c>h?o[h].optional===!0:!0}function c(n,e){this.method=36===n.charCodeAt(0)?n.substring(1,n.indexOf(" ")).toUpperCase():null,null!=this.method&&(n=n.substring(this.method.length+2)),this.strict=f,this.value=e,this.definition=n,t(this,n)}function l(){this.routes=[]}return c.prototype={path:null,query:null,value:null,current:null},l.prototype={add:function(t,n){return this.routes.push(new c(t,n)),this},get:function(t,n){return r(t,this.routes,n)}},l.parse=function(e,r){var i={};return t(i,e),n(i,r)},l}(),g=function(){function t(t){if("undefined"==typeof window||"onhashchange"in window==!1)return null;var n=this;return n.listener=t,window.onhashchange=function(){n.changed(location.hash)},n}function n(t){if("undefined"==typeof window)return null;if(!window.history||!window.history.pushState)return null;var n=this;return n.listener=t,n.initial=location.pathname,window.onpopstate=function(){return n.initial===location.pathname?(n.initial=null,void 0):(n.changed(),void 0)},n}function e(e,r){if(this.collection=e||new p,r){var i="hash"===r?t:n;this.emitter=new i(this)}null==this.emitter&&(this.emitter=new n(this)),null==this.emitter&&(this.emitter=new t(this)),null==this.emitter&&console.error("Router can not be initialized - (nor History API / nor Hashchage")}return"undefined"==typeof window?function(){}:(function(){function n(t){return t.replace(/^[!#/]+/,"/")}t.prototype={navigate:function(t){location.hash=t},changed:function(t){this.listener.changed(n(t))},current:function(){return n(location.hash)}}}(),function(){n.prototype={navigate:function(t){history.pushState({},null,t),this.changed()},changed:function(){this.listener.changed(location.pathname+location.search)},current:function(){return location.pathname+location.search}}}(),e.prototype={changed:function(t){var n=this.collection.get(t);n&&this.action(n)},action:function(t){"function"==typeof t.value&&t.value(t)},navigate:function(t){this.emitter.navigate(t)},current:function(){var t=this.emitter.current();return this.collection.get(t)}},e)}(),d=new p,v={Collection:p,setRouterType:function(t){return null==l&&(l=new g(d,t)),this},setStrictBehaviour:function(t){f=t},add:function(t,n){return c(),d.add(t,n)},get:function(t){return d.get(t)},navigate:function(t){c().navigate(t)},current:function(){return c().current()},parse:p.parse};return function(){function t(t){t.preventDefault(),t.stopPropagation(),v.navigate(this.href)}h.registerAttrHandler("x-dynamic",function(n,e,r,i,u){u.onclick=t},"client")}(),v});